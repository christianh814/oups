


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/hn2-logo-small.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.0.2">
    
    
      
        <title>Full Stack Quickstart - Helpernode v2</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.c1a4d03f.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.fdbf4049.min.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#full-stack-quickstart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Helpernode v2" class="md-header-nav__button md-logo" aria-label="Helpernode v2">
      
  <img src="../assets/images/hn2-logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Helpernode v2
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Full Stack Quickstart
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Helpernode v2" class="md-nav__button md-logo" aria-label="Helpernode v2">
      
  <img src="../assets/images/hn2-logo.png" alt="logo">

    </a>
    Helpernode v2
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Using The helpernodectl CLI
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Using The helpernodectl CLI" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Using The helpernodectl CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../binary/" title="Obtaining The Binary" class="md-nav__link">
      Obtaining The Binary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../shell-completion/" title="Shell Completion" class="md-nav__link">
      Shell Completion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../copy-ign/" title="Copy Ignition Configs" class="md-nav__link">
      Copy Ignition Configs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../get-clients/" title="Get Clients" class="md-nav__link">
      Get Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../preflight/" title="Preflight Checks" class="md-nav__link">
      Preflight Checks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pull/" title="Pulling Images" class="md-nav__link">
      Pulling Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../saving-yaml/" title="Saving YAML Config" class="md-nav__link">
      Saving YAML Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../start/" title="Starting the HelperNode Services" class="md-nav__link">
      Starting the HelperNode Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../restart/" title="Restarting the HelperNode Services" class="md-nav__link">
      Restarting the HelperNode Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../status/" title="Displaying Status" class="md-nav__link">
      Displaying Status
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stop/" title="Stopping the HelperNode Services" class="md-nav__link">
      Stopping the HelperNode Services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Documentation for helpernode.yaml
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Documentation for helpernode.yaml" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Documentation for helpernode.yaml
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../yaml-file-forward/" title="The helpernode.yaml File" class="md-nav__link">
      The helpernode.yaml File
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../helper-section/" title="Helper Section" class="md-nav__link">
      Helper Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dns-section/" title="DNS Server Section" class="md-nav__link">
      DNS Server Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dhcp-section/" title="DHCP Server Section" class="md-nav__link">
      DHCP Server Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bootstrap-section/" title="Bootstrap Node Section" class="md-nav__link">
      Bootstrap Node Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../master-section/" title="Master Nodes Section" class="md-nav__link">
      Master Nodes Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../worker-section/" title="Worker Nodes Section" class="md-nav__link">
      Worker Nodes Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../disabled-section/" title="Disabled Services Section" class="md-nav__link">
      Disabled Services Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ipi-specific/" title="IPI Installation Section" class="md-nav__link">
      IPI Installation Section
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pluggable-services/" title="Pluggable Services" class="md-nav__link">
      Pluggable Services
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sample-yamls/" title="Sample YAML Configurations" class="md-nav__link">
      Sample YAML Configurations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Quickstarts
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Quickstarts" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Quickstarts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Full Stack Quickstart" class="md-nav__link md-nav__link--active">
      Full Stack Quickstart
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../disconnected/" title="Disconnected Installation" class="md-nav__link">
      Disconnected Installation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="full-stack-quickstart">Full Stack Quickstart</h1>
<p>This quickstart will get you "up and running" with the HelperNode so you
can install OpenShift 4. HelperNode v2 will help you install OpenShift
using the Platform Agnostic UPI install method.</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>I will be using the following for my HelperNode:</p>
<ul>
<li>CentOS 8</li>
<li>50GB HD</li>
<li>4 vCPUs</li>
<li>8 GB RAM</li>
</ul>
<p>It's important to note that I used the "Minimal" install profile. Using
this install profiles minimizes the risk of conflicts on the host.</p>
<p><img alt="minimal-install" src="../assets/images/minimal-install.png" /></p>
<p>The network configuration for this example is as follows:</p>
<ul>
<li>IP - <code>192.168.7.77</code></li>
<li>NetMask - <code>255.255.255.0</code></li>
<li>Default Gateway - <code>192.168.7.1</code></li>
<li>Upstream DNS Servers - <code>8.8.8.8</code>, <code>8.8.4.4</code></li>
</ul>
<p>Once the host is installed, you can install the needed packages for
the HelperNode.</p>
<blockquote>
<p>NOTE: The package <code>bash-completion</code> is optional but helpful.</p>
</blockquote>
<pre><code class="language-shell">yum -y install bash-completion podman
</code></pre>
<p>Next, install the <code>helpernodectl</code> CLI utility binary and put it somehwere
in your <code>$PATH</code>, in my example I'm installing it in <code>/usr/local/bin</code></p>
<pre><code class="language-shell">curl -LO https://github.com/RedHatOfficial/ocp4-helpernode/releases/download/v2beta1/helpernodectl
mv helpernodectl /usr/local/bin/
chmod +x /usr/local/bin/helpernodectl
</code></pre>
<p>If you don't have <code>/usr/local/bin</code> in your <code>$PATH</code>, you can export it
with the following command.</p>
<pre><code class="language-shell">export PATH=/usr/local/bin:$PATH
</code></pre>
<p>Enable bash completion</p>
<pre><code class="language-shell">source &lt;(helpernodectl completion bash)
</code></pre>
<h1 id="setting-up-the-yaml-file">Setting Up The YAML File</h1>
<p>You will need to set up your YAML file for your environment. This includes things like knowing the MAC Addresses of the OpenShift nodes that will be installed (either VMs or Bare Metal hosts) and other infrastructure related things. Please consult the <a href="../yaml-file-forward/">YAML File Documentation</a> for more details.</p>
<p>As I'm going to do a "Full Stack" install (using all services). I will
use the following YAML file and save it as <code>helpernode.yaml</code>.</p>
<pre><code class="language-yaml">version: v2
arch: &quot;x86_64&quot;
helper:
  name: &quot;helper&quot;
  ipaddr: &quot;192.168.7.77&quot;
  networkifacename: &quot;ens3&quot;
dns:
  domain: &quot;example.com&quot;
  clusterid: &quot;ocp4&quot;
  forwarder1: &quot;8.8.8.8&quot;
  forwarder2: &quot;8.8.4.4&quot;
dhcp:
  router: &quot;192.168.7.1&quot;
  bcast: &quot;192.168.7.255&quot;
  netmask: &quot;255.255.255.0&quot;
  poolstart: &quot;192.168.7.10&quot;
  poolend: &quot;192.168.7.30&quot;
  ipid: &quot;192.168.7.0&quot;
  netmaskid: &quot;255.255.255.0&quot;
bootstrap:
  name: &quot;bootstrap&quot;
  ipaddr: &quot;192.168.7.20&quot;
  macaddr: &quot;52:54:00:60:72:67&quot;
  disk: vda
masters:
  - name: &quot;master0&quot;
    ipaddr: &quot;192.168.7.21&quot;
    macaddr: &quot;52:54:00:e7:9d:67&quot;
    disk: vda
  - name: &quot;master1&quot;
    ipaddr: &quot;192.168.7.22&quot;
    macaddr: &quot;52:54:00:80:16:23&quot;
    disk: vda
  - name: &quot;master2&quot;
    ipaddr: &quot;192.168.7.23&quot;
    macaddr: &quot;52:54:00:d5:1c:39&quot;
    disk: vda
workers:
  - name: &quot;worker0&quot;
    ipaddr: &quot;192.168.7.11&quot;
    macaddr: &quot;52:54:00:f4:26:a1&quot;
    disk: vda
  - name: &quot;worker1&quot;
    ipaddr: &quot;192.168.7.12&quot;
    macaddr: &quot;52:54:00:82:90:00&quot;
    disk: vda
</code></pre>
<p>It's important to note that <code>helper.ipaddr</code> and <code>helper.networkifacename</code> are found using the <code>ip addr</code> command.</p>
<pre><code class="language-shell"># ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:53:9c:c9 brd ff:ff:ff:ff:ff:ff
    inet 192.168.7.77/24 brd 192.168.7.255 scope global noprefixroute ens3
       valid_lft forever preferred_lft forever
    inet6 fe80::ca70:e130:a9dd:71e8/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
</code></pre>
<h1 id="saving-the-configuration">Saving The Configuration</h1>
<p>Although it's possible to pass <code>--config</code> to the <code>helpernodectl</code> command,
it's better to save it. This saves you from having to pass <code>--config</code>
to each subcommand.</p>
<pre><code class="language-shell">helpernodectl save -f helpernode.yaml
</code></pre>
<p>This will save the file under <code>~/.helper.yaml</code>.</p>
<blockquote>
<p><strong>NOTE</strong>: Do not modify <code>~/.helper.yaml</code> directly. The correct way to
modify is to edit your YAML (<code>helpernode.yaml</code> for example) and rerun the
<code>save</code> subcommand.</p>
</blockquote>
<h1 id="preflight-checks">Preflight Checks</h1>
<p>Now that you have the binary, perform preflight checks to see if there
are any potential issues.</p>
<pre><code class="language-shell">helpernodectl preflight 
</code></pre>
<p>The output should look like this</p>
<pre><code class="language-shell">INFO[0000] RUNNING PREFLIGHT TASKS                      
INFO[0000] Running firewall checks                      
INFO[0001] Preflight checks for Firewall                 Firewall Issues=10
INFO[0001] Starting Port Checks                         
INFO[0001] Preflight checks for Ports                    Port Issues=0
INFO[0001] Starting Systemd Checks                      
INFO[0001] Preflight checks for Systemd                  Systemd Issues=0
INFO[0001] Preflight Summary                             FWRules=10 PortCheck=0 SystemdCheck=0
FATA[0001] Cannot Start, preflight errors found 
</code></pre>
<p>This shows that I have 10 potential firewall rules that are not in place. Preflight also checks for port conflicts (in case you're running other services, <em>NOT</em> recomended btw) and Systemd conflicts as well.</p>
<p>At this point we recommend the users to handle these manually. For more information about what ports are needed, consult the <a href="../preflight/">preflight cli documentation.</a></p>
<p>There is an <em>experimental</em> flag <code>--fix-all</code> that tries to add firewall rules and disable conflicting systemd service.</p>
<pre><code class="language-shell">helpernodectl preflight  --fix-all 
</code></pre>
<p>The output of <code>--fix-all</code> should look like this:</p>
<pre><code class="language-shell">INFO[0000] RUNNING PREFLIGHT TASKS                      
INFO[0000] ==========================BESTEFFORT IN FIXING ERRORS============================ 
INFO[0000] Running firewall checks                      
INFO[0001] OPENING PORT: 6443/tcp                       
INFO[0002] OPENING PORT: 22623/tcp                      
INFO[0003] OPENING PORT: 8080/tcp                       
INFO[0004] OPENING PORT: 9000/tcp                       
INFO[0005] OPENING PORT: 67/udp                         
INFO[0006] OPENING PORT: 53/tcp                         
INFO[0007] OPENING PORT: 53/udp                         
INFO[0008] OPENING PORT: 80/tcp                         
INFO[0009] OPENING PORT: 443/tcp                        
INFO[0010] OPENING PORT: 69/udp                         
INFO[0011] Preflight checks for Firewall                 Firewall Issues=10 Firewall rules added=10
INFO[0011] Starting Port Checks                         
INFO[0011] Preflight checks for Ports                    Port Issues=0
INFO[0011] Starting Systemd Checks                      
INFO[0011] Preflight checks for Systemd                  Systemd Issues=0
INFO[0011] Preflight Summary                             FWRules=10 PortCheck=0 SystemdCheck=0
</code></pre>
<blockquote>
<p>Note, use with caution.</p>
</blockquote>
<p>Once the cli reports <code>No preflight errors found</code>, you can proceed.</p>
<pre><code class="language-shell">helpernodectl preflight 
</code></pre>
<p>Output should say "No preflight errors found":</p>
<pre><code class="language-shell">INFO[0000] RUNNING PREFLIGHT TASKS                      
INFO[0000] Running firewall checks                      
INFO[0001] Preflight checks for Firewall                 Firewall Issues=0
INFO[0001] Starting Port Checks                         
INFO[0001] Preflight checks for Ports                    Port Issues=0
INFO[0001] Starting Systemd Checks                      
INFO[0001] Preflight checks for Systemd                  Systemd Issues=0
INFO[0001] Preflight Summary                             FWRules=0 PortCheck=0 SystemdCheck=0
INFO[0001] No preflight errors found 
</code></pre>
<h1 id="prepulling-images">Prepulling Images</h1>
<p>You can, optionally, prepull images to make startup faster</p>
<pre><code class="language-shell">helpernodectl pull
</code></pre>
<p>This isn't required, as the <code>start</code> command will pull them anyway, but will speed up startup.</p>
<h1 id="starting-services">Starting Services</h1>
<p>Once I have my YAML file ready, saved, and images pulled, I can start the
HelperNode services.</p>
<pre><code class="language-shell">helpernodectl start
</code></pre>
<p>This should run <code>preflight</code> and start the services:</p>
<pre><code>INFO[0001] Found a configuration                        
INFO[0001] RUNNING PREFLIGHT TASKS                      
INFO[0001] Running firewall checks                      
INFO[0002] Preflight checks for Firewall                 Firewall Issues=0
INFO[0002] Starting Port Checks                         
INFO[0002] Preflight checks for Ports                    Port Issues=0
INFO[0002] Starting Systemd Checks                      
INFO[0002] Preflight checks for Systemd                  Systemd Issues=0
INFO[0002] Preflight Summary                             FWRules=0 PortCheck=0 SystemdCheck=0
INFO[0002] No preflight errors found                    
INFO[0002] Starting Containers
======================   
INFO[0002] Validationg configuration in helpernode.yaml 
INFO[0002] Starting helpernode-dns                      
INFO[0002] Validationg configuration in helpernode.yaml 
INFO[0002] Starting helpernode-dhcp                     
INFO[0003] Validationg configuration in helpernode.yaml 
INFO[0003] Starting helpernode-http                     
INFO[0004] Validationg configuration in helpernode.yaml 
INFO[0004] Starting helpernode-loadbalancer             
INFO[0005] Validationg configuration in helpernode.yaml 
INFO[0005] Starting helpernode-pxe
</code></pre>
<blockquote>
<p>Note that a preflight check is done as part of the starting process. You
can skip these checks (to speed up startup, if you've already done
preflight) by passing the <code>--skip-preflight</code> option.</p>
</blockquote>
<p>Once startup as finsihed, you can check to see if it's running.</p>
<pre><code class="language-shell">helpernodectl status
</code></pre>
<p>This should output the running services:</p>
<pre><code>Names                     Status              Image
helpernode-pxe            Up 38 seconds ago   quay.io/helpernode/pxe:latest
helpernode-loadbalancer   Up 40 seconds ago   quay.io/helpernode/loadbalancer:latest
helpernode-http           Up 41 seconds ago   quay.io/helpernode/http:latest
helpernode-dhcp           Up 42 seconds ago   quay.io/helpernode/dhcp:latest
helpernode-dns            Up 42 seconds ago   quay.io/helpernode/dns:latest
</code></pre>
<h1 id="obtaining-the-ocp-clients">Obtaining The OCP Clients</h1>
<p>In order to install OpenShift, I will need the clients. The HelperNode cli
utility can fetch them for you by simply running the <code>get-clients</code> command</p>
<pre><code class="language-shell">helpernodectl get-clients 
</code></pre>
<p>This should output the following</p>
<pre><code>INFO[0000] Getting file openshift-client-linux.tar.gz   
INFO[0000] Getting file openshift-install-linux.tar.gz  
INFO[0000] Getting file helm.tar.gz
</code></pre>
<p>This command fetches the clients into your current working directory.</p>
<pre><code class="language-shell">ls -1 *.gz
</code></pre>
<p>This should output 3 tarballs:</p>
<pre><code>helm.tar.gz
openshift-client-linux.tar.gz
openshift-install-linux.tar.gz
</code></pre>
<p>Go ahead and extract them into your <code>$PATH</code>; I did mine on <code>/usr/local/bin</code></p>
<pre><code class="language-shell">tar -xzf openshift-client-linux.tar.gz -C /usr/local/bin/
tar -xzf openshift-install-linux.tar.gz -C /usr/local/bin/
tar -xzf helm.tar.gz 
mv linux-amd64/helm /usr/local/bin/
rm -f /usr/local/bin/README.md
</code></pre>
<p>You should now have <code>oc</code>, <code>openshift-install</code>, <code>kubectl</code>, and <code>helm</code> in your path</p>
<pre><code class="language-shell">ls -l /usr/local/bin/{oc,openshift-install,kubectl,helm}
</code></pre>
<p>This should list all the binaries that were extracted:</p>
<pre><code>-rwxr-xr-x. 1 3434 3434  41607168 Oct 26 08:36 /usr/local/bin/helm
-rwxr-xr-x. 2 root root  74528264 Nov  4 13:38 /usr/local/bin/kubectl
-rwxr-xr-x. 2 root root  74528264 Nov  4 13:38 /usr/local/bin/oc
-rwxr-xr-x. 1 root root 353038336 Nov  6 04:41 /usr/local/bin/openshift-install
</code></pre>
<h1 id="installing-openshift">Installing OpenShift</h1>
<p>I will take you installing OpenShift at a HIGH level. Please visit the
<a href="https://docs.openshift.com/container-platform/latest/installing/installing_bare_metal/installing-bare-metal.html">Official OpenShift Installation Documentation Site</a> for more specific
details about installing OpenShift.</p>
<p>In order to install OpenShift you will need an ssh key. If you don't have one, create one:</p>
<pre><code class="language-shell">ssh-keygen
</code></pre>
<p>You'll also need a place to store your pull secret. I use <code>~/.openshift</code> as the location:</p>
<pre><code class="language-shell">mkdir -p ~/.openshift
</code></pre>
<p>Visit <a href="https://cloud.redhat.com/openshift/install">cloud.redhat.com</a> and select "Bare Metal" then "UPI". Download your pull secret and save it under <code>~/.openshift/pull-secret</code></p>
<pre><code class="language-shell">ls -1 ~/.openshift/pull-secret
</code></pre>
<p>This should list your pullsecret</p>
<pre><code>/root/.openshift/pull-secret
</code></pre>
<p>Now create an install directory for the <code>openshift-install</code> command to use. </p>
<pre><code class="language-shell">mkdir ~/ocp4
cd ~/ocp4
</code></pre>
<p>Next, create an <code>install-config.yaml</code> file. Here is a sample for my environment:</p>
<blockquote>
<p>NOTE: Make sure to change for your environment where applicable.</p>
</blockquote>
<pre><code class="language-shell">cat &lt;&lt;EOF &gt; install-config.yaml
apiVersion: v1
baseDomain: example.com
compute:
- hyperthreading: Enabled
  name: worker
  replicas: 0
controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3
metadata:
  name: ocp4
networking:
  clusterNetworks:
  - cidr: 10.254.0.0/16
    hostPrefix: 24
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
platform:
  none: {}
pullSecret: '$(&lt; ~/.openshift/pull-secret)'
sshKey: '$(&lt; ~/.ssh/id_rsa.pub)'
EOF
</code></pre>
<p>Next, create the OpenShift install manifest.</p>
<pre><code class="language-shell">openshift-install create manifests 
</code></pre>
<p>This should output the following:</p>
<pre><code>INFO Consuming Install Config from target directory 
WARNING Making control-plane schedulable by setting MastersSchedulable to true for Scheduler cluster settings 
INFO Manifests created in: manifests and openshift 
</code></pre>
<p>Edit the <code>manifests/cluster-scheduler-02-config.yml</code> Kubernetes manifest file to prevent Pods from being scheduled on the control plane machines by setting <code>mastersSchedulable</code> to false.</p>
<blockquote>
<p><strong>NOTE</strong>: Skip this step if you're installing a compact cluster!</p>
</blockquote>
<pre><code class="language-shell">sed -i 's/mastersSchedulable: true/mastersSchedulable: false/g' manifests/cluster-scheduler-02-config.yml
</code></pre>
<p>View the file for varification.</p>
<pre><code class="language-shell">cat manifests/cluster-scheduler-02-config.yml
</code></pre>
<p>The output should look something like this:</p>
<pre><code class="language-yaml">apiVersion: config.openshift.io/v1
kind: Scheduler
metadata:
  creationTimestamp: null
  name: cluster
spec:
  mastersSchedulable: false
  policy:
    name: &quot;&quot;
status: {}
</code></pre>
<p>Next, generate the ignition configs</p>
<pre><code class="language-shell">openshift-install create ignition-configs 
</code></pre>
<p>Now you need copy these ignition configs to the <code>http</code> HelperNode
service. You do this by running the <code>copy-ign</code> command.</p>
<blockquote>
<p>NOTE: You need to pass <code>--dir</code> and the path where the ignition files
are located.</p>
</blockquote>
<pre><code class="language-shell">helpernodectl copy-ign --dir ~/ocp4/
</code></pre>
<p>Output should look something like this</p>
<pre><code>INFO[0000] Copying over /root/ocp4/bootstrap.ign to http container 
INFO[0000] Copying over /root/ocp4/master.ign to http container 
INFO[0000] Copying over /root/ocp4/worker.ign to http container
</code></pre>
<h1 id="install-rhcos">Install RHCOS</h1>
<p>PXE boot into your Instances and they should load up the right configuration based on the MAC address. The DHCP server is set up with MAC address filtering and the PXE service is configured to load the right config to the right machine (based on mac address).</p>
<p>Boot/install the VMs/Instances in the following order</p>
<ul>
<li>Bootstrap</li>
<li>Masters</li>
<li>Workers</li>
</ul>
<p>On your laptop/workstation visit the status page</p>
<pre><code class="language-shell">firefox http://192.168.7.77:9000
</code></pre>
<blockquote>
<p>NOTE: Make sure you don't expose this port in public cloud environments!</p>
</blockquote>
<p>You'll see the bootstrap turn "green" and then the masters turn "green", then the bootstrap turn "red". This is your indication that you can continue.</p>
<p>You need to make sure your DNS on the node is setup correctly. You'll
need to point to <code>localhost</code> (or <code>127.0.0.1</code>) in order to connect to
your cluster.</p>
<p>This is what I have in my <code>/etc/resolv.conf</code></p>
<pre><code class="language-shell">cat /etc/resolv.conf
</code></pre>
<p>This is a sample output:</p>
<pre><code># Generated by NetworkManager
nameserver 127.0.0.1
nameserver 8.8.8.8
</code></pre>
<h1 id="wait-for-install">Wait For Install</h1>
<p>The boostrap VM actually does the install for you; you can track it with the following command.</p>
<pre><code class="language-shell">openshift-install wait-for bootstrap-complete --log-level debug
</code></pre>
<p>Once you see this message below...</p>
<pre><code>DEBUG OpenShift Installer 4.6.4                    
DEBUG Built from commit 6e02d049701437fa81521fe981405745a62c86c5 
INFO Waiting up to 20m0s for the Kubernetes API at https://api.ocp4.example.com:6443... 
INFO API v1.19.0+9f84db3 up                       
INFO Waiting up to 30m0s for bootstrapping to complete... 
DEBUG Bootstrap status: complete                   
INFO It is now safe to remove the bootstrap resources 
DEBUG Time elapsed per stage:                      
DEBUG Bootstrap Complete: 6m42s                    
INFO Time elapsed: 6m42s 
</code></pre>
<p>...you can continue...at this point you can delete/poweroff the bootstrap server.</p>
<blockquote>
<p>NOTE: You can repourpose this machine as another node!</p>
</blockquote>
<h1 id="finish-install">Finish Install</h1>
<p>First, login to your cluster</p>
<pre><code class="language-shell">export KUBECONFIG=/root/ocp4/auth/kubeconfig
</code></pre>
<p>Your install may be waiting for worker nodes to get approved. Normally the <code>machineconfig node approval operator</code> takes care of this for you. However, in a Platform Agnostic UPI install, this needs to be done manually. Check pending CSRs with the following command.</p>
<pre><code class="language-shell">oc get csr
</code></pre>
<p>You can approve all pending CSRs in "one shot" with the following</p>
<pre><code class="language-shell">oc get csr -o go-template='{{range .items}}{{if not .status}}{{.metadata.name}}{{&quot;\n&quot;}}{{end}}{{end}}' | xargs oc adm certificate approve
</code></pre>
<p>You may have to run this multiple times depending on how many workers you have and in what order they come in. Keep a <code>watch</code> on these CSRs</p>
<pre><code class="language-shell">watch oc get csr
</code></pre>
<p>In order to setup your registry, you first have to set the <code>managementState</code> to <code>Managed</code> for your cluster</p>
<pre><code class="language-shell">oc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch '{&quot;spec&quot;:{&quot;managementState&quot;:&quot;Managed&quot;}}'
</code></pre>
<p>For PoCs, using <code>emptyDir</code> is okay (to use PVs follow <a href="https://docs.openshift.com/container-platform/latest/installing/installing_bare_metal/installing-bare-metal.html#registry-configuring-storage-baremetal_installing-bare-metal">this</a> doc)</p>
<pre><code class="language-shell">oc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch '{&quot;spec&quot;:{&quot;storage&quot;:{&quot;emptyDir&quot;:{}}}}'
</code></pre>
<p>If you need to expose the registry, run this command</p>
<pre><code class="language-shell">oc patch configs.imageregistry.operator.openshift.io/cluster --type merge -p '{&quot;spec&quot;:{&quot;defaultRoute&quot;:true}}'
</code></pre>
<p>To finish the install process, run the following</p>
<pre><code class="language-shell">openshift-install wait-for install-complete
</code></pre>
<blockquote>
<p>Note: You can watch the operators running with <code>oc get clusteroperators</code> in another window with a <code>watch</code> to see it progress</p>
</blockquote>
<h1 id="login-to-the-web-console">Login to the web console</h1>
<p>The OpenShift 4 web console will be running at <code>https://console-openshift-console.apps.{{ dns.clusterid }}.{{ dns.domain }}</code> (e.g. <code>https://console-openshift-console.apps.ocp4.example.com</code>)</p>
<ul>
<li>Username: <code>kubeadmin</code></li>
<li>Password: the output of <code>cat /root/ocp4/auth/kubeadmin-password</code></li>
</ul>
<h1 id="upgrade">Upgrade</h1>
<p>If you didn't install the latest release, then just run the following to upgrade.</p>
<pre><code class="language-shell">oc adm upgrade --to-latest
</code></pre>
<p>Scale the router if you need to (if, for example, you installed a compact cluster or are using 3 workers)</p>
<pre><code class="language-shell">oc patch --namespace=openshift-ingress-operator --patch='{&quot;spec&quot;: {&quot;replicas&quot;: 3}}' --type=merge ingresscontroller/default
</code></pre>
<h1 id="done">DONE</h1>
<p>Your cluster should be ready to use!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../sample-yamls/" title="Sample YAML Configurations" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Sample YAML Configurations
              </div>
            </div>
          </a>
        
        
          <a href="../disconnected/" title="Disconnected Installation" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Disconnected Installation
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.606193c2.min.js"></script>
      <script src="../assets/javascripts/bundle.b90b6d1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ["navigation.sections"],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>